<!doctype html>
<html>
  <head>
    <script type="text/javascript" src="jquery-1.8.2.min.js"></script>
    <script type="text/javascript" src="jgpe.js"></script>
    <link href="styles.css" type="text/css" media="all" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1>jgpe<h1>
    </header>

    <p>Click the image to corrupt it. Drag a new image onto the current one to replace it. Click <a id="reset" href="javascript:void(0)">here</a> to reset.</p>

    <img id="image" src="kitten.jpg"/>

    <script type="text/javascript">
      $(function() {
        var selector;
        selector = "#image";
        //the image's selector loads the JpgeImage into the data property so we can write over it on drag/drop
        jgpe.corrupt.loadImageAjax(selector);

        $(selector).on("click", function() {
          var data = $(this).data("jgpe");
          if (data) {
            data.corrupt();
          }
        });

        $("#reset").on("click", function() {
          $("img").each(function() {
            var data = $(this).data("jgpe");
            if (data) {
              data.reset();
            }
          });
        });



        //https://developer.mozilla.org/en-US/docs/Using_files_from_web_applications
        var dropbox;
        dropbox = document.getElementById("image");
        dropbox.addEventListener("dragenter", dragenter, false);
        dropbox.addEventListener("dragover", dragover, false);
        dropbox.addEventListener("drop", function (e) {
          drop(e, selector);
        }, false);

      });

      function dragenter(e) {
        e.stopPropagation();
        e.preventDefault();
      }

      function dragover(e) {
        e.stopPropagation();
        e.preventDefault();
      }

      function drop(e, selector) {
        e.stopPropagation();
        e.preventDefault();

        var dt = e.dataTransfer;
        var files = dt.files;

        jgpe.corrupt.LoadImageFileReader(files[0], selector);
      }

    </script>

  </body>
</html>
