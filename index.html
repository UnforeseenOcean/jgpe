<!doctype html>
<html>
  <head>
    <script type="text/javascript" src="jquery-1.8.2.min.js"></script>
  </head>
  <body>
    <img id="image" src="wtf.jpg"/>
    <!-- <a id="reset" href="javascript:void(0)">reset</a> -->

    <script type="text/javascript">
      $(function() {
        var data, backupData, $image = $("#image"), source = $image.attr("src");

        // $("#reset").on('click', function() {
        //   $image.attr("src", source);
        // });

        $.ajax({
          url: source,
          beforeSend: function ( xhr ) {
            xhr.overrideMimeType("text/plain; charset=x-user-defined");
          },
          success: function(textResponse, whatever, jqXHR) {
            var data = [], i;
            for (i = 0; i < textResponse.length -1; i++) {
              data.push(textResponse.charCodeAt(i) & 0xFF);
            }

            $image.on('click', function() {
              data = corruptImage(data);
            });

          }

        });

      });

      function corruptImage(data) {
        data = shuffle(data);
        $("#image").attr("src", "data:image/jpeg;base64," + encode(data));
        return data;
      }

      function repeat(data, i) {
        setTimeout(function() {

          data = shuffle(data);
          $("#image").attr("src", "data:image/jpeg;base64," + encode(data));

          if (i > 0) {
            repeat(data, i-1);
          }
        }
        , 200);
      }

      function shuffle(data) {
        var start, end, length, index1, index2, temp;
        start = 5;
        end = data.length - 10;
        index1 = getRandom(start, end);
        index2 = getRandom(start, end);

        //single array entry swapping
        temp = data[index1];
        data[index1] = data[index2];
        data[index2] = temp;

        return data;
      }

      function getRandom(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function encode(data) {
        var str = "";
        for (var i = 0; i < data.length; i++)
          str += String.fromCharCode(data[i]);

        return btoa(str).split(/(.{75})/).join("\n").replace(/\n+/g, "\n").trim();
      }

    </script>

  </body>
</html>
